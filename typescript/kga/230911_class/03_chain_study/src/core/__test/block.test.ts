/*  [TDD]
    - íŠ¹ì§•
        - ì—¬ê¸°ì— í…ŒìŠ¤íŠ¸ ì½”ë“œ ìž‘ì„±í•˜ê³  -> ê·¸ ë‹¤ìŒ ê°œë°œë¡œ ë“¤ì–´ê°„ë‹¤. 
        - ì‹¤í–‰ì‹œí‚¤ëŠ” ê±´ JEST! (íŽ˜ì´ìŠ¤ë¶ì—ì„œ ë§Œë“¦)    
        - í…ŒìŠ¤íŠ¸ ë‹¨ìœ„ ë³„ë¡œ ìª¼ê°œì„œ ì§„í–‰í•  ìˆ˜ ìžˆìŒ. 
    
    - íš¨ê³¼ 
        - ì½”ë“œ í’ˆì§ˆì„ ì˜¬ë¦´ ìˆ˜ ìžˆìŒ. 
        - 'ë‹¨ìœ„ë³„ í…ŒìŠ¤íŠ¸' ë¥¼ ì§„í–‰í•˜ê¸° ë•Œë¬¸ì—, ë””ë²„ê¹…ì„ í•˜ê³ , ì½”ë“œ ìž‘ì„±ì„ í•  ìˆ˜ ìžˆìŒ. 

    - ë°©ë²• 
        - 1ë‹¨ê³„ ì½”ë“œë¥¼ ì‹¤í–‰í•˜ê³  -> ê·¸ ë’¤ì—, 2ë‹¨ê³„ ì½”ë“œë¥¼ ì‹¤í–‰ 
        - ex) ìƒìœ„ ì¹´í…Œê³ ë¦¬ì—ì„œ ì‹¤í–‰í•˜ê³  -> ê·¸ ì•„ëž˜ë¡œ ë‚´ë ¤ê°„ë‹¤. 

    - ê¶ê¸ˆì¦ 
        - í…ŒìŠ¤íŠ¸ í•˜ì§€ ì•ŠëŠ”ê±°ëž‘, í…ŒìŠ¤íŠ¸ í•˜ëŠ” ê±°ëž‘ ì–´ë–»ê²Œ ë‹¤ë¥´ì§€? 
        - ë¸”ë¡ì²´ì¸ ë§ê³  ë‹¤ë¥¸ ê²ƒë„ í…ŒìŠ¤íŠ¸ ê°€ëŠ¥? ðŸ‘‰ ì•Œì•„ê°€ë³´ê¸° 
        - í•˜í–¥ì‹ í…ŒìŠ¤íŠ¸ëž‘ ê´€ë ¨ì´ ìžˆë‚˜?
*/

/* [jest ë¡œ í…ŒìŠ¤íŠ¸ í•˜ê¸°]

    [í…ŒìŠ¤íŠ¸ í•˜ë ¤ë©´ í•„ìš”í•œ ìš”ì†Œ]
        - describe : í…ŒìŠ¤íŠ¸ í•˜ê³  ì‹¶ì€ 'ê·¸ë£¹' ì„ ì§€ì •í•œë‹¤.
        - it : í•´ë‹¹ ê·¸ë£¹ ì•ˆì—ì„œ, í…ŒìŠ¤íŠ¸ í•˜ê³  ì‹¶ì€ 'ì¼€ì´ìŠ¤' ë¥¼ ì§€ì •í•œë‹¤. 
        - expect(ë³€ìˆ˜).toBe(ê°’) : íŠ¹ì • ë³€ìˆ˜ì˜ ê°’ì´, toBe ì˜ ê°’ì¸ì§€ ì—¬ë¶€ë¥¼ í…ŒìŠ¤íŠ¸ í•œë‹¤. 
        - ê²€ì‚¬ ê²°ê³¼ëŠ” IDE ì°½ì— ë‚˜ì˜´

    [describe ë¬¸ë²•]
        describe( "ê·¸ë£¹ ì§€ì •" , () => {ê²€ì¦ í•˜ê³ ìž í•˜ëŠ” í•¨ìˆ˜!} )

    [it ë¬¸ë²•]
        it("í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤ ì§€ì •" , () => {ê²€ì¦ í•˜ê³ ìž í•˜ëŠ” í•¨ìˆ˜!} )
    
    [expect, toBe ë¬¸ë²•]
        expect(isValidNewBlock.isError).toBe(false);
            [í•´ì„] ë‚˜ëŠ” isValidNewBlock.isError ì˜ ê°’ì´ ì´ìƒì ìœ¼ë¡œ(toBe) falseê°€ ë˜ê¸°ë¥¼ ê¸°ëŒ€í•œë‹¤(expect)

*/


// ëª¨ë“ˆ import
import { Block } from '@core/block/block'
import { GENESIS } from '@core/config'
import Chain from '@core/chain/chain';


// 'block ê²€ì¦' ê·¸ë£¹ í…ŒìŠ¤íŠ¸ í•˜ê¸°
describe("block ê²€ì¦" , () => {

    let newBlock : Block;
    let newBlock2 : Block;
    let newChain : Chain;

    // í…ŒìŠ¤íŠ¸í•  ì½”ë“œì˜ ìµœì†Œ ë‹¨ìœ„

    // 'ë¸”ë¡ì´ ìž˜ ì¶”ê°€ ë˜ëŠ”ì§€ ì—¬ë¶€' ë¥¼ í…ŒìŠ¤íŠ¸ | ì´ í…ŒìŠ¤íŠ¸ê°€ ë§žë‚˜â“ | 
    it("ë¸”ë¡ ì¶”ê°€" , () => {
        const data = ["Block 1"];       // "ë‰´ìŠ¤ ê¸°ì‚¬" ì²˜ëŸ¼ ìƒˆë¡œìš´ data ë¥¼ ê°€ì ¸ì˜¬ê±°ì•¼
        newBlock = Block.generateBlock(GENESIS, data)   
            // [í•´ì„] 'ë¬¸ì œë¥¼ ë§ží˜€ì„œ, nonce ê°€ ì—…ë°ì´íŠ¸ëœ' block ì´ newBlock ì— ë“¤ì–´ê°. 
        console.log(newBlock)
            
        const data2 = ["Block 2"];
        newBlock2 = Block.generateBlock(newBlock, data2);
            // [í•´ì„] 'ë¬¸ì œë¥¼ ë§ží˜€ì„œ, nonce ê°€ ì—…ë°ì´íŠ¸ëœ' block ì´ newBlock2 ì— ë“¤ì–´ê°. 
        console.log(newBlock2)
    })
        /* [ë‹¨ìœ„ë¥¼ ì´ë ‡ê²Œ ë‚˜ëˆˆ ì´ìœ ëŠ”?]
            - ì—¬ê¸°ì—ì„œëŠ”, ë‹¨ìˆœížˆ, ë¸”ë¡ì„ ì´ë ‡ê²Œ ë‚˜ëˆ„ëŠ” êµ¬ë‚˜! ë¥¼ í…ŒìŠ¤íŠ¸?
        */

    
    it("ë¸”ë¡ ìœ íš¨ì„± ê²€ì¦ | ì •ìƒì ì¸ ë¸”ë¡ì¸ì§€ ê²€ì¦ |" , () => {
        const isValidNewBlock = Block.isValidNewBlock(newBlock , GENESIS)
    
        if(isValidNewBlock.isError){
            // ì„±ê³µí•œ ê²°ê³¼ê°€ ë§žëŠ”ì§€ í™•ì¸í•  ë•Œ ì“°ëŠ” ì½”ë“œ â“
            return expect(true).toBe(false);
                // return expect(isValidNewBlock.isError).toBe(false); -> ì´ê±° ì—¬ì•¼ í•˜ëŠ”ê±° ì•„ë‹Œê°€?
                // expect : toBe ê°’ì´ ë§žëŠ”ì§€ í™•ì¸í•  ë•Œ ì‚¬ìš©í•˜ëŠ” ì½”ë“œ 
        }

        expect(isValidNewBlock.isError).toBe(false)
            /* [í•´ì„]
                ë‚˜ëŠ” isValidNewBlock.isError ì˜ ê°’ì´, ì´ìƒì ìœ¼ë¡œ(toBe), false ê°€ ë˜ê¸°ë¥¼ ê¸°ëŒ€í•œë‹¤(expect)
            */
            /* [ìˆ˜ì—… í•„ê¸°]
                if(isValidNewBlock.isError){        
                 // ì¦‰, ì„±ê³µí•œ ê²°ê³¼ê°€ ë§žëŠ”ì§€ í™•ì¸í•  ë•Œ ì“°ëŠ” ì½”ë“œ  
                    return expect(true).toBe(false);
                expect : toBe ê°’ì´ ë§žëŠ”ì§€ í™•ì¸í•  ë•Œ, ì‚¬ìš©í•˜ëŠ” ì½”ë“œ
                ì´ì „ ë¸”ë¡ì¸ new ë¸”ë¡ì„ ì“°ë©´ ìœ íš¨ì„± ê²€ì‚¬ë¥¼ í†µí™”í•  ê²ƒ 
           */
    })



    it( "chain ì— ë¸”ë¡ ì¶”ê°€" , () => {
        // Chain ì¸ìŠ¤í„´ìŠ¤ ìƒì„±
        newChain = new Chain();
            /*
                Chain ì˜ ì¸ìŠ¤í„´ìŠ¤ = {
                    chain : [GENESIS] 
                    get : function(){ } 
                    length : function(){}
                    latestBlock : function(){}
                    addToChain : (receivedBlock) => {}
                    getBlock : (callbackFn) => {}
                    getBlockByHeight : (height) => {} 
                    getBlockByHash : (hash) => {} 
                    getAdjustBlock : () => {} 
                    serialize : () => {}
                    deserialize : (chunk) => {}
                    replaceChain : (receivedChain) => {}
                    getAdjustmentBlock : () => {}
                }
            */

        // ìƒˆë¡œìš´ data ë¥¼ ì¶”ê°€í•´ì„œ ë§Œë“  block ì„ chain ì— ì¶”ê°€
        newChain.addToChain(newBlock); 
            // [ê¶ê¸ˆì¦]
                // addToChain ì˜ return ì€ this.latestBlock() ìž„. 
                // ê·¸ëŸ¬ë©´, ë°©ê¸ˆ ë§‰ ì¶”ê°€í•œ block ë§Œ ë‚˜ì˜¤ë‚˜? ì–´ë–»ê²Œ í™•ì¸í•˜ì§€â“â“
                console.log(newChain)
    
    
        console.log(newChain.get());        // í˜„ìž¬, ì „ì²´ ì²´ì¸ (block ë“¤ì˜ ë°°ì—´) ì„ í™•ì¸
        
        console.log(newChain.getBlockByHeight(1));      // block ë“¤ ì¤‘ì—ì„œ, ë†’ì´ê°€ 1 ì¸ ê°’, ì„ ê°€ì ¸ì˜¤ê¸°
            /* [ì‹¤í–‰ìˆœì„œ]
                    1. getBlockByHeight ì— ë§¤ê°œë³€ìˆ˜ 1 ì´ ë“¤ì–´ê° 
                    2. getBlockByHeight í•¨ìˆ˜ì—ì„œ this ê°€ í™•ì •ë˜ê³  -> ë§¤ê°œë³€ìˆ˜ê°€ í™•ì •ëœ ìƒí™©ì—ì„œ getBlock ì´ í˜¸ì¶œ 
                    3. getBlock ì—ì„œ this í™•ì • -> chain ì´ ë°°ì—´ì´ë¼ëŠ” ê²Œ í™•ì • -> find ë©”ì†Œë“œ ë¥¼ ë§Œë‚˜ì„œ ë°°ì—´ì„ í•˜ë‚˜ì”© ì½œë°±í•¨ìˆ˜ë¡œ ë˜ì ¸ì„œ 'ì½œë°±í•¨ìˆ˜' ë¥¼ ì‹¤í–‰
            */
    
        console.log(newChain.getBlockByHash(newBlock.hash));        // ìƒˆë¡œìš´ ë¸”ë¡ì˜ hash ë¥¼ ë„£ì–´ì„œ, block ê°€ì ¸ì˜¤ê¸° 
            // [ê¶ê¸ˆì¦] ì°¾ìœ¼ë©´, ë­˜ ë‚´ë³´ë‚´ëŠ” ê±°ì•¼?
                // find ë©”ì„œë“œì— ì˜í•´ì„œ, í•´ë‹¹ ì¡°ê±´ì— ë§Œì¡±í•˜ëŠ”, block ì´ ë‚˜ì˜¤ê²Œ ë¨. 
                // ë‹¨, find ë©”ì„œë“œ íŠ¹ì„±ìƒ, ì•„ë§ˆë„ ì²« ë²ˆì§¸ block. | í˜¹ì‹œë‚˜ ë‚˜ì¤‘ì— ë” ì •êµí•˜ê²Œ í•´ì•¼í•  ìˆ˜ë„
    })
    

    // ë„¤íŠ¸ì›Œí¬ ê°„ ì²´ì¸ ë¹„êµ
    it( "ë„¤í¬ì›Œí¬ ê°„ ì²´ì¸ ë¹„êµ(longest chain rule, ë¡±ê¸°ìŠ¤íŠ¸ ì²´ì¸ ë£°)" , () => {     
        let newChain2 = new Chain()
        newChain2.replaceChain(newChain.get())
            // [í•´ì„] newChain.get() = newChain(ì˜ˆì „ì— ìžˆë˜ chain) ì˜ block ë“¤ì´ ìžˆëŠ” ë°°ì—´

    })


    // ë¸”ë¡ ë‚œì´ë„ ì¡°ì ˆ
    it("ì´ì „ 10ë²ˆì§¸ ë¸”ë¡ or ìµœì´ˆ ë¸”ë¡" , () => {
        
        for(let i = 0; i < 20; i++){
            let block = new Block(GENESIS , ['block'])
            newChain.addToChain(block)
        }

            // forë¬¸ì´ 20ë²ˆ ì‹¤í–‰ ë˜ì—ˆìœ¼ë¯€ë¡œ, newChain ì—ëŠ” 20ê°œì˜ block ë“¤ì´ ìžˆìŒ!   
            console.log(newChain.getAdjustmentBlock());
                // ê¸¸ì´ê°€ 10ë²ˆì§¸ ì¸ ë¸”ë¡! 
    })
        /* [ë‚œì´ë„ ì¡°ì ˆ í•´ì„]
            ëª¨ë“  ë¸”ë¡ì˜ ë†’ì´ê°€ 1ë¡œ í†µì¼ë˜ì–´ ìžˆëŠ”ë°, ì •ë§ ê·¸ëŸ¬í•œì§€ í™•ì¸
            ì´ë ‡ê²Œ ì½”ë“œë¥¼ ì¹˜ë©´, ë™ì¼í•œ GENESIS ë§Œ 20ë²ˆ ìƒì„±ë¨
            ê·¸ëž˜ì„œ, previousBlock ë§¤ê°œë³€ìˆ˜ì—, ì´ì „ì— ìƒì„±ëœ ë¸”ë¡ì„ ë„£ì„ê±°ê³ , 
            ê·¸ê±¸ ë°°ì—´ì— ë„£ê³ , ëì—ê±¸ ê°€ì ¸ì™€ì¤€ë‹¤. 
        */

        /* [í–¥í›„ í•™ìŠµ í¬ì¸íŠ¸]
            ì½”ë“œë¥¼ ë³´ê¸°ë³´ë‹¤ëŠ” 'íë¦„ë„' ë¥¼ ë³´ëŠ”ê²Œ ì¤‘ìš” 
                ë¸”ë¡ì€ ë­ë¡œ êµ¬ì„±ë˜ê³  
                ë¸”ë¡ ìƒì„±, ì²´ì¸ ì¶”ê°€í•  ë•Œ ë¸”ë¡ ê²€ì¦í•´ì„œ ì¶”ê°€í•˜ê³ , ê²€ì¦í•  ë•Œ ë†’ì´ í•´ì‰¬ ë“±ìœ¼ë¡œ í™•ì¸í•˜ê³  
                ë¸”ë¡ í•´ì‹œê°€ ë­ê³ , ë¨¸í´ë£¨íŠ¸ê°€ ë­”ì§€, 
                ì œì¸ ê¸´ ì²´ì¸ì´ ì •ë‹µì´ë‹¤, 
                ë³¸ì¸ ì²´ì¸ë³´ë‹¤ ë” ê¸¸ë©´, ê·¸ê²Œ ì •ë‹µì´ë‹¤, 
        */


        

} )

    
