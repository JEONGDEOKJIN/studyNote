<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>


    <script src="/socket.io/socket.io.js"></script>


    <style>
        body {
            position: relative;
            height: 100vh;
        }
        .content {
            position: absolute;
            /* ë¬´ì¡°ê±´ ê°€ìš´ë°ë¡œ ì˜¤ê²Œ í•˜ê¸° */
            top: 50%;
            left: 50%;
            transform: translate(-50% , -50%);
                /* ë°˜ì§€ë¦„, ë°˜ì§€ë¦„ ë¹¼ë©´ > 'ë¶€ëª¨ê¸°ì¤€' ìœ¼ë¡œ ë¬´ì¡°ê±´ ê°€ìš´ë°ë¡œ ì˜´ */

            width: 500px;
            height: 500px;
            border: 1px solid;
        }

        #send {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            border: 1px solid;
            box-sizing: border-box;
            display: flex;
        }

        #send #msg {
            border: 0;
            box-sizing: border-box;
            padding: 10px;
            width: 85%;
        } 

        #send #sendBtn {
            background-color: beige;
            border: none;
            box-sizing: border-box;
            padding: 10px;
            width: 15%;
        }

        #messages {
            margin: 0;
            padding: 0;
        }

        #messages li {
            list-style: none;
        }

        #login {
            width: 300px;
            height: 300px;
            display: flex;
            align-items: center;
            justify-content: center;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);

        }
        



        /* ë™ì ìœ¼ë¡œ, ëˆ„ê°€ ì ‘ì†í–ˆìŠµë‹ˆë‹¤~ ë¼ê³  ì•Œë ¤ì£¼ëŠ”ê±° */
        .join_text {
            background-color: gray;
        }
    

        /* ë™ì ìœ¼ë¡œ, ëˆ„ê°€ ë– ë‚¬ìŠµë‹ˆë‹¤~ ë¼ê³  ì•Œë ¤ì£¼ëŠ”ê±° */
        .leave_text {
            background-color: goldenrod;
            border: 1px solid;
        }

        /* main ì€ ë¹„ì› ë‹¤ê°€, ë™ì ìœ¼ë¡œ ë¶™ê²Œ í•´ì•¼ í•¨ âœ…âœ… */
        #main {
            display: none;
        }


    </style>



</head>
<body>
    

    <div class="content">
        <div> ê·€ì—¬ìš´ ë™ë¬¼ ì¹´í†¡ </div>
        <div id="login">
            <p> ë¡œê·¸ì¸ | ë‹‰ë„¤ì„ì„ ì •í• ê±°ì•¼ </p>
            <input type="text" id="username">
            <button id="loginBtn"> ì ‘ì† </button>
        </div>

        <div id="main">
            <select name="" id="rooms">
                <option value="ê³ ì–‘ì´ ë°©"> ë°©ì„ íƒ í• ê±°ì•¼ | ê³ ì–‘ì´ ë°© </option>
                <option value="ê°•ì•„ì§€ ë°©"> ë°©ì„ íƒ í• ê±°ì•¼ | ê°•ì•„ì§€ ë°© </option>    
            </select>

            <ul id="messages">
                
            </ul>
            
            <div id="send">
                <input type="text" id="msg">
                <button id="sendBtn">ë³´ë‚´ê¸°</button>
            </div>

            <div id="send2">
                <input type="text" id="msg2">
                <button id="sendBtn2">ê·“ì†ë§</button>
            </div>
        </div>
    </div>

</body>

<script>
    window.onload = () => {
        loginBtn.onclick = () => {
            login.style.display = "none";
            main.style.display = "block";
        
            
            const name = username.value;
            
            // optionã„´ íƒœê·¸ì—ì„œ ë­ê°€ ë‚˜ì˜¤ëŠ”ì§€ 
                console.log(rooms.options);
                    // í˜„ì¬ ì˜µì…˜ë“¤ì„ ë°°ì—´ë¡œ ê°€ì ¸ì˜¨ë‹¤. 
                console.log(rooms.selectedIndex)
                    // í˜„ì¬ ì„ íƒí•œ ì¸ë±ìŠ¤ â­â­â­â­â­â­â­â­ 
            
            // ì„ íƒí•œ ì¸ë±ìŠ¤ì˜ ì˜µì…˜ value ê°’        
                let room = rooms.options[rooms.selectedIndex].value;
                console.log(room);
                    // ì´ê±¸ 'ë°©ì´ë¦„' ìœ¼ë¡œ í•  ì˜ˆì •

            // ì—°ê²° ì‹œë„
                const socket = io.connect();

            // ì ‘ì† í–ˆë‹¤ëŠ” ê±° ì•Œë ¤ì£¼ê¸° 
                socket.emit("joinRoom" , room, name);


            // ê³ ì–‘ì´ë°©, ê°•ì•„ì§€ë°© ë°”ê¿¨ì„ ë•Œ 
                rooms.onchange = function(e) {
                    // ì´ë²¤íŠ¸ê°€ ì¼ì–´ë‚œ íƒœê·¸ë¥¼ ê°€ì ¸ì˜¨ë‹¤.
                    let el = e.target 

                    console.log(el.selectedIndex);

                    // í•´ë‹¹ ìœ ì €ê°€ room ì—ì„œ ë– ë‚¨ 
                        // ê³ ì–‘ì´ ìœ ì €ê°€ ê³ ì–‘ì´ ë°©ì—ì„œ ë– ë‚¨
                    socket.emit("leaveRoom" , room, name);

                    room = room.options[el.selectedIndex].value;
                    socket.emit ("joinRoom" , room, name);
                }
                
            // (ì´ì „ê³¼ì •) ì„œë²„ëŠ”, ì´ê±¸ ë°›ê³ , ë‚˜ë¦„ëŒ€ë¡œ push ë¥¼ í•¨ > ì„œë²„ê°€ ë³´ë‚¸ê±¸ ì´ì œ ë°›ì•„ì„œ > (ì§€ê¸ˆ) ë¸Œë¼ìš°ì €ì—ê²Œ ì¤€ë‹¤.
                socket.on("joinRoom" , (room, name) => {
                    console.log("ì ‘ì†í•¨?âœ…âœ…âœ…âœ…âœ…")

                    messages.innerHTML += `
                    <li class = "join_text">
                        ${name} ë‹˜ì´ ${room} ì— ë“¤ì–´ì™”ìŒâš¡
                    </li>
                    `;
                })

            // ë‚˜ê°”ìŒ~
                socket.on("leaveRoom" , (room, name) => {
                    messages.innerHTML += `
                    <li class ="leave_text">
                        ${name} ë‹˜ì´ ${room} ì—ì„œ ë‚˜ê°”ìŒ~
                    </li>
                    `
                })


            // ğŸ”· ì±„íŒ… ê¸°ëŠ¥ 
                // 
                socket.on("chat" , (name, msg) => {
                    messages.innerHTML += `
                        <li>
                            ${name} : ${msg}
                        </li>
                    `;
                })
            
                // 
                sendBtn.onclick = function() {
                    socket.emit("chat" , room, name, msg.value);
                    msg.value = "";
                        // ì±„íŒ…ì„ ë³´ëƒˆìœ¼ë‹ˆê¹Œ, ë¹„ì›Œì£¼ê¸°
                } 

                // ê·“ì†ë§
                sendBtn2.onclick = () => {
                    socket.emit("chat2" , msg2.value, name, msg.value);
                        // ë°©ì´ ë‹¬ë¼ë„ ê·“ì†ë§ì´ ê°„ë‹¤. 
                        // ì™œëƒë©´, room ì´ ì•„ë‹ˆë¼, ìœ ì € ê¸°ì¤€ìœ¼ë¡œ ë³´ë‚´ë‹ˆê¹Œ â­â­â­â­â­ 
                    msg.value = "";
                }

            // let room = rooms.options;

        }
    }


// â­â­ ì¶”ê°€ ê³¼ì œ í•  ê²ƒ â­â­ 
    // ìœ ì € ì ‘ì†ì„ 'ë°°ì—´' ë¡œ ë§Œë“¤ì–´ë†¨ìŒ. 
    // ì±„íŒ…ë°© ì˜†ì— ì ‘ì†ìë¥¼ ë³´ì—¬ì£¼ëŠ” íƒ­ì„ í•˜ë‚˜ ë§Œë“¤ê²ƒ
    // ì ‘ì†ìê°€ id ë¡œ ë³´ì¼ ìˆ˜ ìˆê²Œ
    // í•´ë‹¹ ê·“ì†ë§ì„ í•  ë•Œ, id ë¥¼ í´ë¦­í•´ì„œ, ê·“ì†ë§ ë²„íŠ¼ì„ ëˆ„ë¥´ë©´, ê·“ì†ë§ì´ ì „ì†¡ë  ìˆ˜ ìˆê²Œ. 


</script>



</html>