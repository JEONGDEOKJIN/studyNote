<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>

    <script src="/socket.io/socket.io.js"></script>

    <style>

        body{
            position: relative;
            height: 100vh;
        }

        .content {
            position: absolute;

            top: 50%;
            left: 50%;
            transform: translate(-50% , -50%);

            width: 500px;
            height: 500px;
            border: 1px solid;
        }

        #send {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            border: 1px solid;
            box-sizing: border-box;
            display: flex;
        }        

        #send #msg {
            border: 0;
            box-sizing: border-box;
            padding: 10px;
            width: 85%;
        } 

        #send #sendBtn {
            background-color: beige;
            border: none;
            box-sizing: border-box;
            padding: 10px;
            width: 15%;
        }

        #messages {
            margin: 0;
            padding: 0;
        }

        #messages li {
            list-style: none;
        }

        #login {
            width: 300px;
            height: 300px;
            display: flex;
            align-items: center;
            justify-content: center;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);

        }


        /* ë™ì ìœ¼ë¡œ, ëˆ„ê°€ ì ‘ì†í–ˆìŠµë‹ˆë‹¤~ ë¼ê³  ì•Œë ¤ì£¼ëŠ” ê±° â­â­â­â­â­â­â­â­â­ */
        .join_text {
            background-color: gray;
        }

        /* ë™ì ìœ¼ë¡œ, ëˆ„ê°€ ë‚˜ê°”ìŠµë‹ˆë‹¤~ ë¼ê³  ì•Œë ¤ì£¼ëŠ” ê±° â­â­â­â­â­â­â­â­â­ */
        .leave_text {
            background-color: yellow;
            border: 1px solid;
        }


        /* ë™ì ìœ¼ë¡œ ë¹„ì› ë‹¤ê°€ ë¶™ê²Œ í•˜ê¸° â­â­â­â­â­â­  */
        #main {
            display: none;
        }


    </style>



</head>
<body>

    <!-- <h1>ì—°ê²° í…ŒìŠ¤íŠ¸</h1>
        <label for=""> í…ìŠ¤íŠ¸ </label> <br>
        <input type="text" id="message"> <br>

        <label for=""> user id </label>
        <input type="text" id="user_id">

        <button id="testBtn"> í…ŒìŠ¤íŠ¸ </button> -->

<div class="content">
    <!-- ì²˜ìŒì— ë³´ì´ê²Œ ë˜ëŠ” í™”ë©´ : ë°‘ì— ë¶€ë¶„ì€ ì•ˆ ë³´ì´ê²Œ í•˜ë‹¤ê°€, display block ìœ¼ë¡œ í•  ê²ƒ ì„ -->
        <div> ê·€ì—¬ìš´ ë™ë¬¼ ì¹´í†¡</div>
        <div id="login">
            <p>ë¡œê·¸ì¸</p>
            <input type="text" id="username">
            <button id="loginBtn">ì ‘ì†</button>
        </div>

    <!-- ë‘ ë²ˆì§¸ ë“¤ì–´ê°€ë©´ ë³´ì´ëŠ” í™”ë©´ : ë°‘ì— ë¶€ë¶„ì€ ë‚˜ì¤‘ì— ë™ì ìœ¼ë¡œ ë³´ì´ê²Œ í•  ê²ƒ ì„ -->
        <div id="main">
            <select name="" id="rooms">
                <option value="ê³ ì–‘ì´ ë°©"> ğŸ˜º ê³ ì–‘ì´ë°© </option>
                <option value="ê°•ì•„ì§€ ë°©"> ğŸ¶ ê°•ì•„ì§€ë°© </option>
            </select>

            <!-- message : ë°©ì— ì…ì¥í–ˆë‹¤~ ë¼ëŠ” ê±¸ ë§í•´ì£¼ëŠ” ê³³ 
                | ë„ˆë¬´ ì‹ ê¸°í•œë°... â­â­â­â­â­â­  -->
            <ul id="messages">

            </ul>

            <div id="send">
                <input type="text" id="msg">
                <button id="sendBtn">ë³´ë‚´ê¸°</button>
            </div>
            
            <div id="send2">
                <input type="text" id="msg2">
                <button id="sendBtn2">ê·“ì†ë§</button>
            </div>
        </div>
</div>






</body>

<script>

    window.onload = () => {

        // ì—°ê²° í…ŒìŠ¤íŠ¸ 
            // 1) ë³´ë‚´ê¸° 
                // testBtn.onclick = () => {
                //     socket.emit("hi" , {msg : message.value , id : user_id.value})
                // }

            // 2) ì„œë²„ë¡œ ë¶€í„° ë°›ì€ ê²ƒ ë¸Œë¼ìš°ì €ì—ê²Œ ë³´ë‚´ê¸°
                // socket.on("hi" , (data) => {

                //     console.log('3ë‹¨ê³„, í´ë¼ê°€ ë°›ë‚˜?' , data.msg)

                //     alert(data);
                // })
                    // [ì• ë§¤í•œ ê²ƒ(ê¶ê¸ˆí•œ ê²ƒ) -> ì•Œê²Œ ëœ ê²ƒ]
                        // ì„œë²„ë¡œ ë¶€í„° ë°›ì€ ë°ì´í„°ëŠ” 'data' ë§¤ê°œë³€ìˆ˜ì— ë“¤ì–´ìˆì„ê¹Œ? 
                            // ì‘ ë‹¤ data ë§¤ê°œë³€ìˆ˜ì— ë“¤ì–´ìˆë„¤? 
                            // [ì•Œê²Œëœ ê²ƒ] 
                                // ë‹¤ë§Œ, í´ë¼ì—ì„œ ì„œë²„ë¡œ ë³´ë‚¸ê±°ë‘ ë‹¤ë¥´ê²Œ, ì„œë²„ì—ì„œëŠ”, data.msg ë§Œ dataë¡œ ë³´ëƒˆìœ¼ë‹ˆê¹Œ, data ìì²´ì˜ ë‚´ìš©ë¬¼ì€ ë‹¬ë¼.
                        // ë³´ë‚¸ë‹¤ëŠ” ê±´ ì–´ë–¤ ë©”ì†Œë“œë¡œ? 
                            // render? show? , (main, "data") ?? 
                            // [ì•Œê²Œëœ ê²ƒ]
                                // ì•„, ì—¬ê¸°ëŠ” java script ê³µê°„ì´ì§€. ê·¸ëƒ¥, alert ë¥¼ ì‚¬ìš©í•´ë„ ë¸Œë¼ìš°ì €ì—ê²Œ ë³´ì—¬ì¤„ ìˆ˜ 
                                
                    // [ì—ëŸ¬]
                        // alert ê°€ ì•ˆ ë‚˜ì˜¤ë„¤
        
        // 'ì ‘ì†' ë²„íŠ¼ í´ë¦­  
            loginBtn.onclick = () => {

                // 1. ë²„íŠ¼ í´ë¦­ í•˜ë©´ > 'ì°©ì‹œ íš¨ê³¼' ë¡œ ë‹¤ìŒ í˜ì´ì§€ ë³´ì´ê²Œ í•˜ê¸°
                    login.style.display = "none";
                    main.style.display = "block";

            // ğŸ”· ê³ ì–‘ì´ ë°©ì— ë“¤ì–´ê°€ë©´, ê³ ì–‘ì´ ë°©ì— ë“¤ì–´ê°”ë‹¤ê³  í‘œì‹œí•˜ê¸° 
                // 2. ë“¤ì–´ê°„ roomê³¼ ì‚¬ìš©ì name ì„ í‘œì‹œí•˜ê¸° ìœ„í•´, í•„ìš”í•œ ì •ë³´ ê°€ì ¸ì˜¤ê¸° 
                    // ì‚¬ìš©ì ë¡œê·¸ì¸ ì´ë¦„ 
                        const name = username.value;
                    
                    // option ì¤‘ ì–´ë–¤ ê°’ì„ ê°€ì ¸ì™€ì•¼ í•˜ëŠ”ì§€ í™•ì¸                        // rooms.options ê¸°ëŠ¥í™•ì¸
                        // console.log("rooms.options" , rooms.options);
                            // idê°€ roomsì¸ select íƒœê·¸ ì•ˆì— ìˆëŠ” ëª¨ë“  option ê³¼ ê´€ë ¨ëœ ì •ë³´ë¥¼ ë‚´ë³´ëƒ„
                        // rooms.selectedIndex ê¸°ëŠ¥ í™•ì¸
                        // console.log("rooms.selectedIndex" , rooms.selectedIndex);
                            // idê°€ roomsì¸ select íƒœê·¸ ì•ˆì—ì„œ, ì–´ë–¤ option ì´ ì„ íƒë˜ì—ˆëŠ”ê°€, ë¥¼ ë‚˜íƒ€ëƒ„
                        
                        // room ì— ì„ íƒí•œ option ì˜ value ê°€ì ¸ì˜¤ê¸° â­â­â­â­â­ 
                        let room = rooms.options[rooms.selectedIndex].value
                        // [í•´ì„]
                            // â­â­â­ ì¤‘ìš” 
                            // 1) room ì„ íƒí•œ ê±°ì—ì„œ index ë¥¼ ê°€ì ¸ì˜´
                            // 2) rooms.option ì—ì„œ ì ‘ê·¼í•  ìˆ˜ ìˆëŠ” ë§ì€ ê°’ì¤‘, ì„ íƒí•œ index ë¥¼ í• ë‹¹ 
                            // 3) ê·¸ ì•ˆì— .value ì— ì ‘ê·¼í•´ì„œ ê°€ì ¸ì˜¤ê¸°
                        
                        
                        // [ì§ˆë¬¸] 
                                // ì´ê±°ë‘, ìœ„ì—ê±°ë‘, ë­ê°€ ë‹¤ë¥´ì§€â“â“â“
                                // ìœ„ì— console.log ëŠ” option íƒœê·¸ì—ì„œ, ì–´ë–¤ í•˜ìœ„ ìš”ì†Œë¥¼ ì„ íƒí•  ìˆ˜ ìˆëŠ”ì§€ í…ŒìŠ¤íŠ¸ í•´ë´„ 
                                // ì§€ê¸ˆ ë³€ìˆ˜ëŠ”, ì‹¤ì§ˆì ìœ¼ë¡œ, 'ë‚´ê°€ ì„ íƒí•œ ë°©ì˜ ê°’' ì„ ê°€ì ¸ì˜¤ê³  ìˆë‹¤.
                        console.log(room)


                // 3. ì„œë²„ì™€ ì—°ê²°ëœ socket ê°ì²´ ë§Œë“¤ê¸°
                    const socket = io.connect();
                        // io | ë¼ì´ë¸ŒëŸ¬ë¦¬ ì—°ê²°ì„ í†µí•´ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ê°ì²´ 
                        // connect | ì„œë²„ì™€ ì—°ê²°í•˜ê²Œ í•´ì£¼ëŠ” ë©”ì†Œë“œ 
                        // socket | ë¼ì´ë¸ŒëŸ¬ë¦¬ì—ì„œ ë°›ì€, ì†Œì¼“ ê´€ë ¨ ë©”ì†Œë“œ, ê°ì²´ ë¥¼ ê°–ê³  ìˆì„ ê²ƒ

                // 4. ì„œë²„ì—ê²Œ join Room ì´ë²¤íŠ¸ ë³´ë‚´ê¸°
                    // 1) ê¸°ë³¸ì ì¸ ì „ì†¡
                        socket.emit("joinRoom" , room, name);
                
                    // 2) ë³€í™”ê°€ ìƒê¸¸ ê²½ìš° ì—…ë°ì´íŠ¸ | rooms select íƒœê·¸ì— ë³€í™”ê°€ ìƒê¸°ë©´, ë°˜ì˜í•´ì„œ, ë‹¤ì‹œ ë³´ë‚´ê¸° â­â­â­â­â­
                        rooms.onchange = function(e){
                            // CF. ë³€í™”ê°€ ì¼ì–´ë‚œ ê±¸ ì–´ë–»ê²Œ ì°¾ì•„ê°ˆ ê²ƒ ì¸ê°€ â­â­â­â­â­ 
                            
                            // ë³€í™”ê°€ ì¼ì–´ë‚œ íƒœê·¸ë¥¼ ê°€ì ¸ì˜¨ë‹¤ â­â­â­
                                let el = e.target;
                            // í•´ë‹¹ íƒœê·¸ì—ì„œ indexê°€ ì°íˆëŠ”ì§€ í™•ì¸ 
                                console.log(el.selectedIndex);

                            // ìœ ì €ê°€ ë– ë‚œ ê²ƒ ì²˜ë¦¬ 
                                socket.emit("leaveRoom" , room, name)
                                    // [ì§ˆë¬¸] 
                                        // leaveRoom ìœ¼ë¡œ ë‹¤ë¥¸ ì´ë²¤íŠ¸ë¥¼ ì„¤ì •í•˜ë©´, ì„œë²„ì—ì„œ ë‹¤ë¥´ê²Œ ë°˜ì‘í•˜ë‚˜?
                                        // ì‘. ê·¸ëŸ¬ë„¤. ë‹¤ë¥´ê²Œ ë°˜ì‘í•˜ë„¤.  
                            
                            // ìƒˆë¡­ê²Œ í´ë¦­í•œ ê²ƒìœ¼ë¡œ room ì— ë„£ê¸° 
                                room = rooms.options[el.selectedIndex].value;
                            
                            // â­â­â­ joinRoom ì— ë‹¤ì‹œ ë³´ë‚´ê¸°
                                socket.emit("joinRoom" , room , name);
                    // [ì‹œì‚¬ì ]
                        // 1) ë°©ì— ë“¤ì–´ê°€ëŠ”ê²Œ ìœ ë™ì ìœ¼ë¡œ ë³€í•  ìˆ˜ ìˆëŠ” ìƒí™©ì´ë©´, â­â­â­â­â­â­  
                            // a) ê¸°ë³¸ì ìœ¼ë¡œ ë³´ë‚´ê³  
                            // b) ìœ ë™ì ìœ¼ë¡œ ë³€ê²½ëœ ì •ë³´ë¥¼ ê°€ì ¸ì™€ì„œ ë‹¤ì‹œ ë‹´ê³  
                            // c) ìµœì¢…ì ìœ¼ë¡œ 'ë³€ê²½ëœ ì •ë³´ë¥¼ ë°˜ì˜í•´ì„œ emit' í•´ì¤˜ì•¼ í•œë‹¤. 

                        }
                
                // 5. ë°©ì— ì…ì¥í•˜ë©´, ì…ì¥í–ˆë‹¤!!! ëŠ” ë¬¸êµ¬ ë„ì›Œì£¼ê¸°
                    socket.on("joinRoom" , (room , name) => {
                        messages.innerHTML += `
                        <li class = "join_text">
                            ${name} ë‹˜ì´ ${room}ì— ë“¤ì–´ì™”ìŒ~
                        </li>
                        `;
                    });

                // 6. ë°©ì—ì„œ ë‚˜ê°€ë©´, ë‚˜ê°”ë”°!! ë¬¸êµ¬ ë„ìš°ê¸° 
                    socket.on("leaveRoom" , (room , name) => {
                        messages.innerHTML = `
                        <li class = "leave_text">
                            ${name} ë‹˜ì´ ${room} ì—ì„œ ë‚˜ê°”ìŒ ã… ã…  
                        `
                    });
                
            // ğŸ”· ì±„íŒ… ê¸°ëŠ¥ 
                // 2. í´ë¼ê°€ í¬ë¼ìš°ì €ì—ê²Œ, ë Œë”ë§ í•˜ê²Œ í•œë‹¤. 
                    socket.on("chat" , (name, msg) => {
                        messages.innerHTML += `
                        <li> 
                            ${name} : ${msg}
                        </li>
                        `;
                    })
                // 1. ë³´ë‚´ê¸° í´ë¦­ì‹œ, 'ì„œë²„ì—ê²Œ' 'ì±„íŒ…ë°©, ìœ ì € ì´ë¦„, ë©”ì‹œì§€' data ì „ë‹¬í•˜ê² ë‹¤. 
                    sendBtn.onclick = () => {
                        socket.emit("chat" , room, name, msg.value);
                        // í•´ì„ 
                            // room | í˜„ì¬, ì–´ë–¤ ë°©ì— ë“¤ì–´ê°€ ìˆëŠ”ì§€ë¥¼ ë³´ë‚´ê² ë‹¤. 
                            // name | ì‚¬ìš©ì ì´ë¦„. 
                            // msg.value | input íƒœê·¸ì— ë‹´ê¸´ ë°ì´í„°
                        msg.value = "";
                            // [ê¶ê¸ˆì¦]
                                // ì´ê±¸ ì™œ ì´ˆê¸°í™” í•´ì•¼ í•˜ì§€? 
                    }


                // 3. [ê·“ì†ë§] ì„œë²„ë¡œ ë°ì´í„° ë³´ë‚´ê¸° 
                    sendBtn2.onclick = () => {
                        socket.emit("chat2" , msg2.value, name, msg.value);
                            // [ì§ˆë¬¸]
                                // ê·¼ë° ë³´ë‚¼ ë•Œ, msg2.value ë‘ , ë’¤ì— id , name, msg ì´ê±°ë‘ ì•ˆ ë§ëŠ”ê±° ì•„ëƒ? 
                                // [ì•Œê²Œ ëœ ê²ƒ]
                                    // ì•„, ì•„ë‹ˆë„¤, msg2.value == ê·¸ input ì•ˆì—ëŠ” ê·“ì†ë§ í•˜ê³  ì‹¶ì€ id ë¥¼ ê¸°ì¬í•˜ë‹ˆê¹Œ, ì„œë²„ì—ì„œ ë§ë„¤ 
                                    // ì„¸ë²ˆì§¸ ë§¤ê°œë³€ìˆ˜ì¸ msg.value ëŠ” msg ë‹ˆê¹Œ, ì´ê²ƒë„ ë§ê³  
                                    // ì¦‰, â­â­ ì„œë²„ì—ì„œ ë§¤í•‘ì€ ìˆœì„œëŒ€ë¡œ ë  ê²ƒ â­â­ 
                        msg.value = "";
                    }

                // 4. [ê·“ì†ë§] ì„œë²„ë¡œ ë¶€í„°, ì†Œì¼“ ì§€ì • ë°›ì•„ì„œ ë Œë”? 
                    // socket.on("chat2" , (name, msg) => {
                    //     messages.innerHTML += `
                    //     <li>
                    //         ${name} ë‹˜ì˜ ê·“ì†ë§ : ${msg} 
                    //     </li>
                    //     `
                    // })
                    // [ì§ˆë¬¸]
                        // ë‹¹ì—°íˆ, ì´ê²Œ í•„ìš”í•  ì¤„ ì•Œì•˜ëŠ”ë°, ì•„ë‹ˆë„¤? ì™œì§€? 


            }


            // íŒíŠ¸ 
            
            // optionã„´ íƒœê·¸ì—ì„œ ë­ê°€ ë‚˜ì˜¤ëŠ”ì§€ 
                // console.log(rooms.options);
                    // í˜„ì¬ ì˜µì…˜ë“¤ì„ ë°°ì—´ë¡œ ê°€ì ¸ì˜¨ë‹¤. 
                // console.log(rooms.selectedIndex)
                    // í˜„ì¬ ì„ íƒí•œ ì¸ë±ìŠ¤ â­â­â­â­â­â­â­â­ 
        
        
    }

</script>

</html>