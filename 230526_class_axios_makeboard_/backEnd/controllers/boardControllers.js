


const { Post, User } = require("../models")


// ê²Œì‹œê¸€ ìƒì„± ê¸°ëŠ¥ 
    exports.boardCreate = async (req, res) => {

        // 1. msg, id ì–´ë””ì— ë‹´ê²¨ ìˆë‚˜ ì°¾ê¸°
            // 1-1) msg
            console.log("âœâœâœ",req.body.msg)
            msg = req.body.msg

            // 1-2) id ì°¾ê¸° 
            console.log("ğŸ”®ğŸ”®ğŸ”®" , req.acc_decoded.id)
            user_id = req.acc_decoded.id
            // [ì•Œê²Œëœ ê²ƒ]
                // [acc_decoded íƒí—˜] â­â­â­â­â­ 
                    // 1. jwt ë¯¸ë“¤ì›¨ì–´ ë•Œë¬¸ì´ë¼ëŠ” ê±¸ ì•Œê²Œ ë¨ 
                    // 2. isLogin ì„ í†µê³¼í•´ì•¼ í•œë‹¤ëŠ” ê±¸ ì•Œê²Œ ë¨. 
                    // 3. isLogin ì„ 'ì œëŒ€ë¡œ í†µê³¼' í•˜ë©´, 'ì½œë°± í•¨ìˆ˜' ê°€ ì‹¤í–‰ 
                        // 	3.1 í•´ë‹¹ ì½œë°±í•¨ìˆ˜ì˜ ë‘ ë²ˆì§¸ ì¸ìë¡œ, 'ë””ì½”ë”©ëœ í˜ì´ë¡œë“œ ê°’(acc_decoded ì— ë³µí˜¸í™”ëœ ê°’)' ì´ ì „ë‹¬ëœë‹¤. 
                    // 4. 'ì œëŒ€ë¡œ í†µê³¼í•´ì„œ ì–»ê²Œëœ ë””ì½”ë”©ëœ í˜ì´ë¡œë“œê°’' ì€ req ê°ì²´ì— í• ë‹¹ í•œë‹¤. 
                    // 5. ê·¸ë˜ì„œ, ìš”ì²­ - ì²˜ë¦¬ ì—ì„œ ì¨ë‚´ì“¸ ìˆ˜ ìˆê²Œ ëœë‹¤. 
                    // 6. (ê·¸ë˜ì„œ, req.acc_decoded ë¡œ êº¼ë‚´ì“¸ ìˆ˜ ìˆìœ¼ë ¤ë©´, ìš°ì„ , payload ì— ë“¤ì–´ê°€ì•¼ í•œë‹¤.)

        // 2. msg sql ì— ì €ì¥ 
            await Post.create({
                msg : msg,
                user_id : user_id 
            })
            

        // 3. í•´ë‹¹ ìœ ì €ê°€ ì‘ì„±í•œ ê¸€ì„ ë³¼ ìˆ˜ ìˆëŠ” í˜ì´ì§€ë¡œ ì´ë™  
            res.redirect(`http://127.0.0.1:5500/frontEnd/myboard.html`)
            // res.redirect(`/frontEnd/board.html`)
                // [ì•Œê²Œëœ ê²ƒ | íë¦„ ë”°ë¼ê°€ê¸°]
                    // 1. ìš°ì„ , ì—¬ê¸°ì—ì„œ, '/board/view/1' ì—¬ê¸°ë¡œ ê°€ë‹¬ë¼ê³  ìš”ì²­í•œê±°ì•¼ 
                    // 2. ê·¸ëŸ¬ë©´, ëŒ€ì²´ ì–´ë””ì—ì„œ ë³´ì´ëŠ”ê±°ì•¼? ë¥¼ ìƒê°í•´ë³´ë©´, ê·¸ ë‹¤ìŒì—” 'ë¼ìš°í„°' ë¡œ ê°„ë‹¤. 
                    // 3. ê·¸ë˜ì„œ, 'í•´ë‹¹ ê²½ë¡œ' ëŠ” 'ì–´ë–¤ controller' ë¡œ ê°€ì•¼í•˜ëŠ”ì§€ í™•ì¸í•œë‹¤. 
                    // 4. ë‹¤ë§Œ, ë°”ë¡œ ê°€ëŠ”ê²Œ ì•„ë‹ˆë¼, isLogin ìœ¼ë¡œ ê³„ì† í† í°ì„ í™•ì¸í•œë‹¤. â­â­â­â­â­ 
                    // 5. routers ì—ì„œ, 'ê²½ë¡œ' ë¥¼ ì ëŠ”ë°, 'url ê²½ë¡œì—ì„œ ë³€ìˆ˜ ì—­í• ì„ í•˜ëŠ”ê²Œ place holer?' 
                        // 5.1 ê·¸ë˜ì„œ, '/view/:id' ì´ë ‡ê²Œ ê²½ë¡œë¥¼ ì ìŒ 
                
                // [ìƒê°í•´ë³¼ ê²ƒ]
                    // ì´ë ‡ê²Œ redirect ë¥¼ ìš”ì²­í•˜ë©´, í•´ë‹¹ ê²½ë¡œì— ëŒ€í•´ì„œ, get ìš”ì²­, ì´ ë“¤ì–´ê°€ëŠ” ê±´ê°€? 
                    // ê·¸ëŸ¬ë©´, 'router' ì—ì„œ ì´ê±¸ ë³´ì—¬ì¤„ ìˆ˜ ìˆëŠ” ì²˜ë¦¬ë¥¼ í•´ì•¼ê² ë„¤? 

    }



// íŠ¹ì • ìœ ì €ê°€ ì‘ì„±í•œ ê²Œì‹œê¸€ì„ ë³´ì—¬ì£¼ëŠ” ê¸°ëŠ¥ 
    exports.boardView = (req, res) => {

        // 1. ì¡°íšŒí•  id ê°€ ì œëŒ€ë¡œ ë„˜ì–´ì˜¤ëŠ”ì§€ í™•ì¸ 
            console.log("req.params.idğŸ¥™ğŸ¥™" , req.params.id);        
            // req.params.id ë¥¼ í•˜ëŠ” ì´ìœ  : routing url ì—ì„œ placeholder ì— ë‹´ê²¨ì„œ id ê°€ ë„˜ì–´ì™”ê¸° ë•Œë¬¸ì— 

        // 2. í•´ë‹¹ id ì— í•´ë‹¹í•˜ëŠ” user row ì™€ post row ê°€ì ¸ì™€ì„œ > ë Œë” ê¸°ëŠ¥ì— í† ìŠ¤ í•˜ê¸°
            User.findOne(
            {
                where : {id : req.params.id},
                    // [í•´ì„] 
                        // User record(row, ê°€ë¡œ) ì¤‘ì—ì„œ, req.params.id ì™€ ì¼ì¹˜í•˜ëŠ” ì• ë“¤ì„ ê°€ì ¸ì™€!
                include : [
                    {model : Post}
                ]
                    // [í•´ì„]
                        // â­â­â­ 'í˜„ì¬ ì¡°íšŒí•˜ëŠ” id' ë¡œ ì‘ì„±í•œ ëª¨ë“  'Post í…Œì´ë¸”ì˜ record' ë¥¼ ê°€ì ¸ì™€ â­â­â­â­â­
                        // ê·¸ëŸ¬ë©´, Post í…Œì´ë¸”ì˜ ì˜¤ë¥¸ìª½ ì—´ì—ì„œ, í•´ë‹¹í•˜ëŠ” id ë¡œ ì¡°íšŒí•˜ê³ , > ê·¸ê±¸ 'ë°°ì—´' ì— ë‹´ê³  > User ê°ì²´ ì•ˆì— ì†í•´ì§€ê² ì§€.

                    // [í•´ì„]
                        // 1) ì´ê±´, Post í…Œì´ë¸”ì—ì„œ, id ê°€ 1 ì— í•´ë‹¹í•˜ëŠ” ë°ì´í„° (foreignKey ë¥¼ id ì™€ ì—°ê²°í–ˆìŒ) ë¥¼ ëª¨ë‘ ê°€ì ¸ì™€ì„œ 
                        // 2) ë°°ì—´ì— ë‹´ê³ , ë„˜ê²¨ë¼, ë¼ëŠ” ê±°ì§€? 
            }
            ).then( (e) => {
                // í™”ì‚´í‘œ í•¨ìˆ˜ëŠ” { } ê´„í˜¸ê°€ ë¹ ì§€ë©´, ë°”ë¡œ ë°˜í™˜ ì‹œí‚¨ë‹¤. 
                // return ë¬¸ ìƒëµ ê°€ëŠ¥ 
                
                // 1) ë‹´ì•„ì˜¨ post ê°€ ì–´ë””ìˆëŠ”ì§€ í™•ì¸
                    console.log("ğŸ˜ºğŸ˜ºğŸ˜º" , e.dataValues.Posts[0].dataValues)
                        // ê²°ê³¼ë¬¼
                            //     id: 1,
                            //     msg: '123123',
                            //     createdAt: 2023-05-26T08:11:35.000Z,
                            //     updatedAt: 2023-05-26T08:11:35.000Z,
                            //     user_id: 1
                            //   }
                        // ê°ê°ì˜ post ëŠ” 'ë°°ì—´' ì— ë‹´ê²¨ì ¸ ì˜¨ë‹¤ëŠ” ì  â­ -> so, í•˜ë‚˜ì”© ì ‘ê·¼í•´ë³´ê¸° 
                        // ê·¸ ë°°ì—´ì€ 'ê°ì²´ë“¤ì´ ë‹´ê²¨' ìˆìŒ. > so, key ê°’ì„ ë„£ì–´ì„œ, ë¹¼ë‚¸ë‹¤.  
                    console.log("ğŸ¥™ğŸ¥™ğŸ¥™ğŸ¥™ğŸ¥™ğŸ¥™ğŸ¥™ğŸ¥™ğŸ¥™ğŸ¥™ğŸ¥™ğŸ¥™ğŸ¥™ğŸ¥™")
                    e.dataValues.Posts = e.dataValues.Posts.map( (i) => i.dataValues);
                        // [ê¶ê¸ˆì¦ ë° í•´ì„ğŸ˜¥ğŸ˜¥ğŸ˜¥]
                            // e.dataValues.Posts.map( (i) => i.dataValues); ì´ ê²°ê³¼, Post[0].dataValues ê²°ê³¼ë¬¼ì´ ë°°ì—´ë¡œ ë‹´ê¸°ëŠ” ê±´ ì•Œê² ìŒ. 
                            // ê·¸ëŸ°ë°, êµ³ì´ e.dataValues.Posts ë¥¼ ì•ˆ ì¨ì¤˜ë„ ë˜ì§€ ì•Šë‚˜? 

                    const Posts = e.dataValues;

                    // console.log(Posts)
                    
                    res.json(Posts)
                    
                    console.log("boardController ë ê¹Œì§€ ì •ìƒ ì‘ë™ğŸš€ğŸš€ğŸš€ğŸš€ğŸš€ğŸš€ğŸš€ğŸš€ğŸš€ğŸš€ğŸš€ğŸš€ğŸš€ğŸš€ğŸš€")

                    // ë°‘ì—ê±´ esj ë°©ì‹
                        // res.render("board" , {data : Posts});
                            // [í•´ì„] 
                                // Posts ëŠ” 'ë°°ì—´' ì¸ë°, Posts[0] ì€ ê°ì²´ ë¼ëŠ” ì !
                            
            })
        }
            // [ì´ ì‘ì—…ì˜ ê²°ê³¼ë¬¼]
            // 1) User ê°ì²´ì™€ ê·¸ ì•ˆì— ìˆëŠ” Posts ê°ì²´ê°€ ë‚˜ì˜´ 
                // ì¦‰, User ê°ì²´ ì•ˆì—ëŠ” Postsë¼ëŠ” ì†ì„±ì´ ìˆê³ , 
                // ì´ Posts ì†ì„±ì€ í•´ë‹¹ ì‚¬ìš©ìê°€ ì‘ì„±í•œ ëª¨ë“  ê²Œì‹œë¬¼(Post ê°ì²´ë“¤)ì„ ë°°ì—´ í˜•íƒœë¡œ í¬í•¨í•¨. 
                // 


// ëª¨ë“  ìœ ì €ê°€ ì‘ì„±í•œ ëª¨ë“  ê²Œì‹œê¸€ ë³´ê¸°
    exports.allBoardView = (req, res) => {
        let nameArr = [];

        // ëª¨ë“  user ë¥¼ ì°¾ì•„ì„œ ê°€ì ¸ì˜¤ê¸° 
        User.findAll({
            include : [
                {model : Post}
            ]
        }).then((e) => {
        
            // name ì„ ê°€ì ¸ì˜¤ë ¤ë©´ ì–´ë–»ê²Œ íƒ€ê³ ë“¤ì–´ê°€ì•¼ í•˜ë‚˜
                // console.log( "name âœ:" , e[0].dataValues.name);
                // console.log( "name âœ:" , e[1].dataValues.name); 
                // [ê²°ê³¼ë¬¼]
                    // name âœ: 123
                    // name âœ: 12
                // 'ë°°ì—´' ì— ë„£ê¸° (ê°ê° ë‹¤ë¥¸ ë°°ì—´ì— ë„£ì„ê±°ì§€ë§Œ, index ë¥¼ ë§ì¶°ì„œ, ê·¸ ì‚¬ëŒì˜ ë°ì´í„°ê°€ ì˜¤ê²Œ í•´ì•¼ í•¨)
                    let user_nameArr = []
                
                    e.forEach( (el) => {
                        user_nameArr.push(el.dataValues.name)
                    });

            // msg ë¥¼ ë½‘ìœ¼ë ¤ë©´, ì–´ë–»ê²Œ ì ‘ê·¼í•´ì•¼ í•˜ë‚˜
                // console.log("msg ğŸŒ» :" , e[0].dataValues.Posts[0].dataValues.msg)
                // console.log("msg ğŸŒ» :" , e[0].dataValues.Posts[1].dataValues.msg)
                // [ê²°ê³¼ë¬¼] 
                    // msg ğŸŒ» : 123123
                    // msg ğŸŒ» : dhdhdhdhdh
                
                // ë°°ì—´ì— ë„£ê¸° 
                    let user_postsArr = [];

                    e.forEach( (el) => {
                        el.dataValues.Posts.forEach((el) => {
                            user_postsArr.push(el.dataValues.msg)
                        })
                    });
            
            // ê°ì²´ì— í•©ì³ë³´ê¸°                
                // ë‚´ê°€ ìµœëŒ€í•œ ì§œë³´ê³ , ì•ˆ ë˜ë©´ > gpt ì—ê²Œ ë¬¼ì–´ë´ì„œ, ì§¬ â­â­â­â­â­ 
                const user_info = e.map( (el, index) => {
                    return {
                        name : el.dataValues.name, 
                        msg :   el.dataValues.Posts.map((post) => {
                            return post.dataValues.msg;
                        })
                    }
                });
                                

            // ì˜ ë‚˜ê°€ë‚˜ ë””ë²„ê¹… : 2ì°¨ì— ì™„ì„± | ë‚´ê°€ ìµœëŒ€í•œ ì§œê³  - gpt í•œí…Œ ìˆ˜ì •í•´ë‹¬ë¼
                // 1ì°¨ 
                    // console.log("ğŸ¶ğŸ¶ğŸ¶ğŸ¶ğŸ¶" , user_info)
                    // [ê²°ê³¼ë¬¼]
                    // ìŒ... ë½‘í˜€ ë‚˜ì˜¤ê¸´ í•˜ëŠ”ë°, ì´ msg ê°€ user1 ê»€ì§€ ëª¨ë¥´ê²Œ ë‚˜ì˜´ 
                    // name: [ '123', '12', '111', '1', 'bestname', '321', '222' ],
                    // msg: [
                    //     '123123',
                    //     'dhdhdhdhdh',
                    //     '123123',
                    //     'hihihi',
                    //     'hihihi',
                    //     'slakdfj',

                // 2ì°¨ 
                // console.log("ğŸ¶ğŸ¶ğŸ¶ğŸ¶ğŸ¶" , user_info)

            // ë‚´ë³´ë‚´ê¸° 
                res.json(user_info)
            
        })
    }