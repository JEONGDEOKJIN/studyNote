import {UserParams} from '../interfaces/login.request'

import {AuthenticationResponse, Authenticator} from './Authenticator.interface'


// ì „ëµíŒ¨í„´ ê°ì²´ êµ¬ì¡° ì •ì˜
    // ì „ëµ íŒ¨í„´ ì„œë¹„ìŠ¤ ë¡œì§ì„ í•˜ë‚˜ì˜ ê°ì²´ì— ë‹´ì•„ë†“ê³  ì‚¬ìš©í•  ê²ƒ ì„ 

interface IStrategy {
    [key : string] : Authenticator
        // [ìˆ˜ì—… í•„ê¸°]
            // í•´ë‹¹ êµ¬ì¡°ì˜ ê°ì²´ë¥¼ ë°›ì„ ê±´ë°, ê°ì²´ì˜ key ë¥¼ string ìœ¼ë¡œ ì¤„ê±°ì•¼! ë¼ê³  ì •ì˜ 
            // a.b ë¡œ ê°ì²´ë¥¼ í˜¸ì¶œí•˜ê±°ë‚˜, a["b"] ì´ë ‡ê²Œ í˜¸ì¶œí–ˆì—ˆìŒ 
            // ê·¸ë˜ì„œ key ë¥¼ ë¬¸ìì—´ë¡œ ì§€ì •! 
            // key ê°€ ë™ì ìœ¼ë¡œ ì¶”ê°€ ë  ìˆ˜ ìˆë‹¤ëŠ” ì˜ë¯¸ â­â­â­ 
                // ê²€ì¦ê°ì²´ êµ¬ì¡°, ë¥¼ ê°–ê³  ìˆëŠ” ê°ì²´ê°€ ë“¤ì–´ì˜¬ê±°ì•¼! ë¼ê³  ë§Œë“ ê²ƒ ì„.

        // [ver2.1 í•´ì„] ğŸ”µ(ìµœì‹ ) 
            // ì´ê³³ì€ 1ë‹¨ê³„. 1ë‹¨ê³„ëŠ” 'interface ê·œì¹™ì„ ìƒì„±' í•˜ê¸°ë§Œ í•¨. | ì‹¤ì œë¡œ ê°ì²´ë¥¼ ìƒì„±í•˜ì§€ ì•ŠìŒ! 
            // ì–´ë–¤ ê·œì¹™ì„ ìƒì„±í•˜ëŠ”ê°€? 
                // IStrategy (interface of strategy) ë¼ëŠ” ê·œì¹™ì€
                    // 1) ê°ì²´ ì—¬ì•¼ í•˜ê³  
                    // 2) ê°ì²´ key ë¥¼ ë™ì í• ë‹¹ìœ¼ë¡œ ìƒì„±í•˜ëŠ” ë¶€ë¶„ì´ ìˆì–´ì•¼ í•˜ê³  
                    // 3) ê°ì²´ key ì˜ ê°’ì€ Authenticator íƒ€ì…ì„ ë”°ë¼ì•¼ í•´ 
                    // 4) 'Authenticator íƒ€ì…' ì€ input ì— 'UserParams íƒ€ì…ì˜ credential ë³€ìˆ˜' ê°€ ë“¤ì–´ê°€ê³ , 
                        // -> ê·¸ input ì´ authenticate ë©”ì†Œë“œì— ì˜í•´ ì²˜ë¦¬ë˜ê³  
                        // -> output ì´ 'AuthenticationResponse' íƒ€ì…ìœ¼ë¡œ ë‚˜ì˜¤ë©´, 
                        // ê·¸ output ì´ key ì˜ ê°’ì´ ë˜ëŠ”ê±°ì•¼. 

            // ê·¸ëŸ¬ë©´, 2ë‹¨ê²Œì—ì„œ, ê·œì¹™ì— ê·¼ê±°í•´ì„œ, ê°ì²´ë¥¼ ìƒì„±, í•´ë³´ì. 
        
}

// ì„œë¹„ìŠ¤ ë¡œì§ë“¤ì„ ê°€ì§ˆ ê°ì²´ êµ¬ì¡° ì •ì˜
class Strategy {
    private strategy : IStrategy = { }
        // [ver2.1 í•´ì„] ğŸ”µ(ìµœì‹ ) 
            // [2ë‹¨ê³„] IStrategy íƒ€ì…ì˜ ë³€ìˆ˜ì¸ strategy ë¥¼ ë§Œë“¤ì—ˆìŒ.
            // ë‹¤ë§Œ, ì•„ì§, í•´ë‹¹ ê°ì²´ì—, ë©¤ë²„ ì†ì„± ë° ë©”ì†Œë“œë¥¼ ì •ì˜í•œ ê±´ ì•„ë‹˜!!!
            
            // ê·¸ëŸ¬ë©´, 3ë‹¨ê³„ì—ì„œ, ë§Œë“¤ì–´ì§„ ê°ì²´ì—, 'ë©¤ë²„ ë³€ìˆ˜' ì™€ 'set ë©”ì†Œë“œ' ë¥¼ ì¶”ê°€í•´ë³´ì 

                    // [ver2.0 í•´ì„] 
                        // IStrategy íƒ€ì…ì˜ strategy ë³€ìˆ˜ë¥¼ ë§Œë“ ë‹¤. 
                        // 'IStrategy íƒ€ì…' ì€ 1) string ì´ì–´ì•¼ í•˜ê³ , 2) Authenticator íƒ€ì… ì´ì–´ì•¼ í•œë‹¤. 
                        // 'Authenticator íƒ€ì…' ì€ 1) authenticate ë©”ì†Œë“œê°€ ìˆê³  2) í•´ë‹¹ ë©”ì†Œë“œì˜ input ì—ëŠ” 'UserParams íƒ€ì…ì˜ credential' 3) output ì— 'AuthenticationResponse' íƒ€ì…, ì´ ìˆì–´ì•¼ í•œë‹¤. 
                        // ğŸ“›ğŸ“› 'UserParams íƒ€ì…ì˜ credential' ì€ 1) email : string 2) password : string ì˜ í˜•ì‹ì´ì–´ì•¼ í•œë‹¤. 
                            // [ì§ˆë¬¸] ê·¸ëŸ¬ë©´, ì´ë•Œ, ê°’ì€ ì‹¤ì œë¡œ ë¹„ì–´ ìˆë‚˜? ì•„ë‹ˆë©´, ê·¸ëƒ¥ ì•„ì§ í• ë‹¹ì´ ì•ˆ ëœ ìƒíƒœ ì¸ê°€? â“â“â“ 
                                // ğŸ‘‰ ë¹„ì–´ ìˆëŠ” ìƒíƒœ, í›„ì—, set ë©”ì„œë“œë¥¼ í†µí•´, strategy ê°ì²´ ë‚´ë¶€ì— ë™ì ìœ¼ë¡œ ê°’(ì „ëµ)ì„ ì¶”ê°€ ìŒ. 

                        // 'AuthenticationResponse' ì€ 1) success : boolean 2) message? : string ì´ì–´ì•¼ í•¨. 
                            // [ì§ˆë¬¸] ê·¸ëŸ¬ë©´, strategy ë³€ìˆ˜ì—ëŠ”, ê²°êµ­, 1) userParms ê°€ ë“¤ì–´ì™€ì„œ 2) authenticate ê°€ ì‹¤í–‰ë˜ê³  3) ê·¸ ê²°ê³¼ê°’ì¸, AuthenticationResponse ì´ê²Œ ë‹´ê²¨ì•¼ í•˜ë‚˜? 
                                // ğŸ‘‰ ì•„ë‹ˆ, strategy ë³€ìˆ˜ëŠ” 1) IStrategy íƒ€ì…ì˜ 2) ë¹ˆ ê°ì²´ ì„. 
                                // ğŸ‘‰ strategy ë³€ìˆ˜ì—ëŠ” 1) ì—¬ëŸ¬ ì „ëµì´ ë‹´ê¸°ê²Œ ëœë‹¤. -> ì–¸ì œ ì „ëµì´ ë‹´ê¸°ëŠ” ê±´ë°? -> ê·¸ëŸ¬ë©´, ì´ ë•Œ, ë“¤ì–´ì˜¬ ë•Œ, ì € íƒ€ì… ìœ í˜•ì„ ì§€ì¼œì•¼ ê² ë„¤!? 


    // ì„œë¹„ìŠ¤ ë¡œì§ì„ ê°ì²´ì— ì¶”ê°€í•  í•¨ìˆ˜ | â­â­â­â­â­ 'ì „ëµ'ì„ 'ë“±ë¡' 
        // ì´ key ê°€ ê°ì²´ì— ì¶”ê°€ë˜ëŠ” key ê°€ ë  ê²ƒ ì„. 
    public set(key : string , authenticate : Authenticator){
        // key ê°’ì„ ë°›ê³ , ì„œë¹„ìŠ¤ ë¡œì§ ì¶”ê°€
        this.strategy[key] = authenticate
            // [ìˆ˜ì—… í•„ê¸°] ì´ ìœ„ì— key ë¡œ , ì „ë‹¬í•  ê°ì²´ë¥¼ ì¶”ê°€  
            
            
        }
            // [ver2.1 í•´ì„] ğŸ”µ(ìµœì‹ )
                // 3ë‹¨ê³„ì—ì„œ set ë©”ì†Œë“œì˜ ê¸°ëŠ¥ì„ ì •ì˜í•œë‹¤. 
                // ë§Œì•½ set ë©”ì†Œë“œê°€ ì–´ë– í•œ ë§¥ë½ì—ì„œ ì‹¤í–‰ëœë‹¤ë©´, ë‹¤ìŒì˜ ì¼ì´ ë²Œì–´ì§„ë‹¤. 
                    // 1) string ìœ¼ë¡œ ëœ key ê°€ ìƒê¸´ë‹¤. 
                    // 2) í•´ë‹¹ key ì— Authenticator íƒ€ì…ì´  authenticate ë³€ìˆ˜ì— ë‹´ê¸´ë‹¤. 
                // ì¦‰, set ì´ ì–´ë– í•œ ë§¥ë½ì—ì„œ ì‹¤í–‰ëœë‹¤ë©´, ë‹¤ìŒì˜ ê°ì²´ê°€ ë§Œë“¤ì–´ì§€ëŠ” ê²ƒ ì´ë‹¤.             
                    // [ì˜ˆì‹œ] set ë©”ì†Œë“œë¥¼ someObject.set('login', loginAuthenticator); ì´ë ‡ê²Œ í˜¸ì¶œí•˜ë©´, ì•„ë˜ì™€ ê°™ì€ ê°ì²´ê°€ ëœë‹¤ â­â­â­â­â­
                        /* 
                            this.strategy = {
                                google(key ì—ì„œ í• ë‹¹ë°›ì€ ê°’): loginAuthenticator
                            };
                        */ 
                        /* ë˜ëŠ” ì´ë ‡ê²Œ ë‚˜ì˜¨ë‹¤ â­â­â­â­â­â­â­ 
                            this.strategy = {
                                google(key ì—ì„œ í• ë‹¹ë°›ì€ ê°’): authenticate(credentials)
                            };
                        */

                // ë‹¤ë§Œ, ì´ë ‡ê²Œ ì •ì˜ëœ set ë©”ì†Œë“œê°€ ì•„ì§ ì‹¤í–‰ëœ ê±´ ì•„ë‹˜! 
                // ì´ì œ 4ë‹¨ê³„ì—ì„œ set ë©”ì†Œë“œë¥¼ ì‹¤í–‰í•˜ì 
                
                                    // [ver2.0 í•´ì„]
                                        // ì™¸ë¶€ì—ì„œ ì ‘ê·¼í•  ìˆ˜ ìˆëŠ”(public) ë©¤ë²„ í•¨ìˆ˜ì¸ set ì„ ë§Œë“ ë‹¤. 
                                        // ì´ set ì€ 1) ë¬¸ìë¡œ ëœ key ë¥¼ í• ë‹¹ ë°›ê³  2) Authenticator íƒ€ì…ì¸ authenticate ë³€ìˆ˜ê°€ ë§¤ê°œë³€ìˆ˜ë¡œ ë“¤ì–´ì˜¨ë‹¤. 
                                            // 'Authenticator íƒ€ì…' ì€ input ì— 'UserParams íƒ€ì…ì˜ credential ë³€ìˆ˜' ê°€ ë“¤ì–´ê°€ê³ , 
                                            // -> ê·¸ input ì´ authenticate ë©”ì†Œë“œì— ì˜í•´ ì²˜ë¦¬ë˜ê³  
                                            // -> output ì´ 'AuthenticationResponse' íƒ€ì…ì€, í•„ìˆ˜ì ìœ¼ë¡œ success ë¥¼ boolean íƒ€ì…ìœ¼ë¡œ ë°˜í™˜í•˜ë¯€ë¡œ,
                                            // â­â­ ê²°êµ­, authenticate ë³€ìˆ˜ì—ëŠ”, ' íƒ€ì…ì˜ ê°’' ì´ ë“¤ì–´ê°€ê³  -> í•œë‹¨ê³„ ë” ë“¤ì–´ê°€ë©´, ê·¸ì œì„œì•¼ boolean ê°’ì´ ë‚˜ì˜¤ê²Œ ëœë‹¤.
                                                // í¬ì¸íŠ¸ëŠ” 'í•´ë‹¹ íƒ€ì…' ì´ ì–´ë””ì— í• ë‹¹ë˜ëŠ”ê°€! AuthenticationResponseí•˜ëŠ” ê±¸, ì‰¬ìš´ ë§ë¡œ ì„¤ëª…í•  ìˆ˜ ìˆì–´ì•¼ í•œë‹¤. â­â­ 

                                        // ì´ë ‡ê²Œ authenticate ë³€ìˆ˜ ê°’ì´ ì •í•´ì§€ë©´, ì´ ê°ì²´ì˜ strategy ì†ì„±ì˜ ë™ì í• ë‹¹ëœ key ì—ëŠ” Authenticator íƒ€ì…ì˜ ê°’ì´ ë“¤ì–´ê°€ê³ ,
                                            // í•´ë‹¹ ê°ì²´ì—ì„œ authenticate ë©”ì„œë“œë¥¼ í˜¸ì¶œí•˜ë©´, â­â­â­ (ë‚˜ëŠ” ë©”ì„œë“œ í˜¸ì¶œë¡œ í•´ì„í•˜ì§€ ëª» í–ˆëŠ”ë°! ì´ë ‡ê²Œ í•  ìˆ˜ë„ ìˆë„¤)
                                            // 'AuthenticationResponse íƒ€ì…ì˜ ê°’' ì„ í”„ë¡œë¯¸ìŠ¤ë¡œ ë°˜í™˜í•˜ê²Œ ëœë‹¤.  

                                        // ì´ë ‡ê²Œ , ê°’ì´ ì •í•´ì§„ authenticate ë³€ìˆ˜ê°’ì€, í•´ë‹¹ ê°ì²´ì˜ strategy ì†ì„±ì˜ key ì˜ value ë¡œ í• ë‹¹ëœë‹¤ â­â­â­
                                            // ì´ë•Œ, í• ë‹¹ì€, 'ê°ì²´ë‚˜ í•¨ìˆ˜ ë“±ì˜ ì°¸ì¡°(reference) ë¥¼ í• ë‹¹' í•˜ëŠ” ê²ƒ ì´ë‹¤. -> ë”°ë¼ì„œ, strategy ê°ì²´ì—ì„œ, í•´ë‹¹ key ë¥¼ ì‚¬ìš©í•´ì„œ, authenticate ë©”ì†Œë“œë¥¼ í˜¸ì¶œí•˜ë©´ -> ì›ë˜ì˜ authenticate ë³€ìˆ˜ê°€ ê°€ë¦¬í‚¤ëŠ” ê°ì²´ë‚˜ í•¨ìˆ˜ì¸ authenticate ë©”ì„œë“œê°€ ì‹¤í–‰ëœë‹¤.
                                                // (ì´ê²Œ, ì°¸ì¡°ì— ì˜í•œ í• ë‹¹(pass-by-reference)
                                            // ë‹¤ë§Œ, ì´ê²Œ 100% ì´í•´ ë˜ì§€ëŠ” ì•ŠìŒ. ğŸ˜¥ğŸ˜¥ğŸ˜¥ 



    public async login (type : string, credentials : UserParams) : Promise<AuthenticationResponse>{
        // google, {email , password} google ì— ëŒ€í•œ í‚¤ ê°’ì„ ì‹¤í–‰ì‹œí‚¤ë©´ì„œ, ì„ì‹œ ê°ì²´ ê°’ì„ ì „ë‹¬
        const result = await this.strategy[type].authenticate(credentials); 
            // ì—¬ê¸°ì— ì„±ê³µ ì‹¤íŒ¨ê°€ ë‹´ê¸¸ ê²ƒ 
            // type ì´ êµ¬ê¸€ì´ë©´, êµ¬ê¸€ ë¡œê·¸ì¸ ë¡œì§ í•¨ìˆ˜ê°€ ì‹¤í–‰ë  ê²ƒ. 

        return result
    }
        // [ver2.1 í•´ì„] ğŸ”µ(ìµœì‹ )
            // login ë©”ì†Œë“œì˜ ì „ì œëŠ” set ë©”ì†Œë“œê°€ ì´ë¯¸ ì‹¤í–‰ë˜ì–´ì„œ, type ì™€ authenticate ê°€ í• ë‹¹ë˜ì–´ ìˆë‹¤! ë¼ëŠ” ì  ì´ë‹¤. 
            // ì´ì œ login ë©”ì†Œë“œì—ì„œëŠ” ë­˜ í•˜ë‚˜?  
                // 1) ì—¬ëŸ¬ê°œì˜ strategy ì¤‘ 'ì„ íƒ' í•œë‹¤. 
                // 2) ê·¸ë ‡ê²Œ ì„ íƒí•œ ì†ì„±ì˜ ë©”ì†Œë“œë¥¼ ì‹¤í–‰ í•œë‹¤. 
            // êµ¬ì²´ì ìœ¼ë¡œ ì½”ë“œë¡œ ë³´ë©´ 
                // this.strategy[type] = ì´ ë¶€ë¶„ì€ ë‹¤ì–‘í•œ key ì¤‘ í•˜ë‚˜ì˜ type ì„ ì„ íƒ 
                // authenticate(credentials) = ì´ ë¶€ë¶„ì€ í•´ë‹¹ type ì— ì´ë¯¸! í• ë‹¹ë˜ì–´ ìˆëŠ” authenticate ë¥¼ ì‹¤í–‰
                // const result =  authenticator íƒ€ì…ì— ì˜í•´, AuthenticationResponse íƒ€ì…ì„ ë°˜í™˜í•œë‹¤.

                                    // [2.0ver í•´ì„] | ì˜ˆì „ ë²„ì „ 
                                        // login ë©”ì†Œë“œì˜ input : 1) ë¬¸ìì—´ë¡œ ëœ type ë³€ìˆ˜ 2) UserParams íƒ€ì…ì˜ credentials ë³€ìˆ˜
                                                // 'UserParams íƒ€ì… ì˜ˆì‹œ
                                                    // export interface UserParams {
                                                    //     email : string
                                                    //     password : string
                                                    // }
                                        // login ë©”ì†Œë“œ ì²˜ë¦¬ ìˆœì„œ 
                                            
                                            // 1) 'type ë³€ìˆ˜ì— ì ì¸ ë¬¸ìì—´' ì´ this.strategy ë¼ëŠ” ê°ì²´ì˜ 'ì†ì„±' ì´ ëœë‹¤. 
                                                /* ì˜ˆë¥¼ ë“¤ì–´, ì´ë ‡ê²Œ ë˜ë‚˜?
                                                        this.strategy = {
                                                        "google(typeì—googleì´ë¼ê³  ì íŒê²½ìš°)": authenticate(credentials)
                                                    };
                                                */  

                                                // ì—¬ê¸°ì—ì„œ authenticate, credentials ëŠ” ì–´ë””ì—ì„œ ì˜¤ë‚˜? 
                                                    // authenticate ëŠ” set ë©”ì†Œë“œì˜ ë§¤ê°œë³€ìˆ˜ ì•„ë‹ˆì•¼? 

}


export default Strategy
