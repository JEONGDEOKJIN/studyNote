import {UserParams} from '../interfaces/login.request'
import {AuthenticationResponse, Authenticator} from './Authenticator.interface'


// [1ë‹¨ê³„] interface ê·œì¹™ë§Œ ìƒì„±
interface IStrategy {
    [key : string] : Authenticator
        // [ver2.1 í•´ì„] ğŸ”µ(ìµœì‹ ) 
            // ì´ê³³ì€ 1ë‹¨ê³„. 1ë‹¨ê³„ëŠ” 'interface ê·œì¹™ì„ ìƒì„±' í•˜ê¸°ë§Œ í•¨. | ì‹¤ì œë¡œ ê°ì²´ë¥¼ ìƒì„±í•˜ì§€ ì•ŠìŒ! 
            // ì–´ë–¤ ê·œì¹™ì„ ìƒì„±í•˜ëŠ”ê°€? 
                // IStrategy (interface of strategy) ë¼ëŠ” ê·œì¹™ì€
                    // 1) ê°ì²´ ì—¬ì•¼ í•˜ê³  
                    // 2) ê°ì²´ key ë¥¼ ë™ì í• ë‹¹ìœ¼ë¡œ ìƒì„±í•˜ëŠ” ë¶€ë¶„ì´ ìˆì–´ì•¼ í•˜ê³  
                        // ë™ì í• ë‹¹ì€ ì–´ë–¤ ì†ì„±ì¸ì§€ë¥¼ ì§€ê¸ˆ ì •í•˜ì§€ ì•Šê³ , ë‚˜ì¤‘ì—, ë³€ìˆ˜ ì•ˆì— ê°’ì„ ë„£ì–´ì¤Œìœ¼ë¡œì¨ ê²°ì •ëœë‹¤.
                    // 3) ê°ì²´ key ì˜ ê°’ì€ Authenticator íƒ€ì… ì„. 
                    // 4) 'Authenticator íƒ€ì…'ì€ âœ…'í•¨ìˆ˜' ì„.(ğŸ˜¥ğŸ˜¥ğŸ˜¥ëª°ëì—ˆìŒ)
                        // â­â­â­ ì´ ë¶€ë¶„ì´ êµ‰ì¥íˆ ì¤‘ìš”í•¨. ë‘ë£¨ë­‰ì‹¤í•œ íƒ€ì…ìœ¼ë¡œ ì½ëŠ”ê²Œ ì•„ë‹ˆë¼, js íƒ€ì… ê¹Œì§€ ì½ì–´ë‚¼ ìˆ˜ ìˆì–´ì•¼ í•œë‹¤. â­â­â­ 
                    // 5) ì–´ë–¤ í•¨ìˆ˜ëƒë©´, 
                        // input ìœ¼ë¡œ 'UserParams' ì…ë ¥ì„ ë°›ê³ , output ìœ¼ë¡œ 'AuthenticationResponse' íƒ€ì…ì„ ë‚´ë³´ë‚´ëŠ” ë©”ì†Œë“œ
                    // 6) ê²°êµ­, strategy ê°ì²´ì˜ ê° keyëŠ” â­'í•¨ìˆ˜ë¥¼ ì°¸ì¡°(ğŸ˜¥ğŸ˜¥ğŸ˜¥ëª°ëì—ˆìŒ)'â­ í•˜ë©°, í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•  ë•Œ, AuthenticationResponse íƒ€ì…ì„ ë°˜í™˜

            // ê·¸ëŸ¬ë©´, 2ë‹¨ê²Œì—ì„œ, ê·œì¹™ì— ê·¼ê±°í•´ì„œ, ê°ì²´ë¥¼ ìƒì„±, í•´ë³´ì. 
}


class Strategy {
    // [class ë¥¼ ëŒ€í•˜ëŠ” íŒ]
        // 1) 'í´ë˜ìŠ¤ ì •ì˜ë¥¼ ë³´ê³  -> ì–´ë–¤ ê°ì²´ê°€ ìƒì„±ë  ê²ƒ ì¸ê°€.' ë¥¼ ê·¸ë ¤ë‚˜ê°ˆ ìˆ˜ ìˆì–´ì•¼ í•œë‹¤. â­â­â­ 
            // ì™œëƒë©´, 'ì‹¤í–‰ë˜ëŠ” ì½”ë“œ ë§¥ë½' ì„ ë³¼ ë•Œ, ë§Œë‚˜ëŠ” ê±´, ì¸ìŠ¤í„´ìŠ¤ ë‹¤. 
            // ê·¸ 'ì¸ìŠ¤í„´ìŠ¤ì˜ ì†ì„±ê³¼ ë©”ì†Œë“œ'ë¥¼ ì•Œì•„ì•¼, í•´ë‹¹ 'ì‹¤í–‰ ì½”ë“œ ë§¥ë½' ì˜ ê¸°ëŠ¥ì„ ì´í•´í•  ìˆ˜ ìˆë‹¤. 
            // 'ì¸ìŠ¤í„´ìŠ¤ì˜ ì†ì„±ê³¼ ë©”ì†Œë“œ'ë¥¼ ì•Œê¸° ìœ„í•´ì„œëŠ”, í´ë˜ìŠ¤ ì•ˆì—ì„œ 'ì–´ë–¤ ì†ì„±ê³¼ ë©”ì†Œë“œ' ë¡œ ì •ì˜ ë˜ì—ˆëŠ”ì§€ ì•Œì•„ì•¼ í•œë‹¤. 
            // ê·¸ëŸ¬ë©´, í´ë˜ìŠ¤ê°€ ì •ì˜ëœ ë¶€ë¶„ì„ ë“¤ì–´ê°€ì„œ í™•ì¸í•  í…ë°, ê·¸ë•Œ, 'ì´ í´ë˜ìŠ¤ì— ë”°ë¼ì„œ -> ì–´ë–¤ ê°ì²´ê°€ ë§Œë“¤ì–´ì§ˆê¹Œ.' ë¥¼ ìì—°ìŠ¤ëŸ½ê²Œ ê·¸ë¦´ ìˆ˜ ìˆìœ¼ë©´ ë„ì›€ì´ ë  ê²ƒ ì´ë‹¤. 

    // [2ë‹¨ê³„] 'ë¹ˆ ê°ì²´' ìƒì„±
    private strategy : IStrategy = { }
        // [ver2.1 í•´ì„] ğŸ”µ(ìµœì‹ ) 
            // [2ë‹¨ê³„] IStrategy íƒ€ì…ì˜ ë³€ìˆ˜ì¸ strategy ë¥¼ ë§Œë“¤ì—ˆìŒ.
            // ë‹¤ë§Œ, ì•„ì§, í•´ë‹¹ ê°ì²´ì—, ë©¤ë²„ ì†ì„± ë° ë©”ì†Œë“œë¥¼ ì •ì˜í•œ ê±´ ì•„ë‹˜!!!
            
            // 2ë‹¨ê³„ë¥¼ ê±°ì¹˜ë©´, ì¸ìŠ¤í„´ìŠ¤ëŠ” ì´ëŸ° ëª¨ì–‘ì´ ë¨ 
                /* instance = { 
                        strategy : {}
                    }
                */
            // ê·¸ëŸ¬ë©´, 3ë‹¨ê³„ì—ì„œ, ë§Œë“¤ì–´ì§„ ê°ì²´ì—, 'ë©¤ë²„ ë³€ìˆ˜' ì™€ 'set ë©”ì†Œë“œ' ë¥¼ ì¶”ê°€í•´ë³´ì 


// [3ë‹¨ê³„] set ë©”ì†Œë“œ ì •ì˜ë§Œ í•¨ | ì‹¤í–‰ì€ ì•„ì§ ì•ˆ í•¨ 
    // ì„œë¹„ìŠ¤ ë¡œì§ì„ ê°ì²´ì— ì¶”ê°€í•  í•¨ìˆ˜ | â­â­â­â­â­ 'ì „ëµ'ì„ 'ë“±ë¡' 
        // ì´ key ê°€ ê°ì²´ì— ì¶”ê°€ë˜ëŠ” key ê°€ ë  ê²ƒ ì„. 
    public set(key : string , authenticate : Authenticator){
        // key ê°’ì„ ë°›ê³ , ì„œë¹„ìŠ¤ ë¡œì§ ì¶”ê°€
        this.strategy[key] = authenticate
            // [ìˆ˜ì—… í•„ê¸°] ì´ ìœ„ì— key ë¡œ , ì „ë‹¬í•  ê°ì²´ë¥¼ ì¶”ê°€  
        }

            // [ver2.2 í•´ì„] | í´ë˜ìŠ¤ë¥¼ 'ê°ì²´ ê´€ì (ì´ ì½”ë“œë¥¼ ê±°ì¹˜ë©´, instance ëŠ” ì´ë ‡ê²Œ ë¨(1)UML ì„ ì ëŠ” ëŠë‚Œ 2)classê°€ ì‹¤í–‰ë˜ë©´ ê°ì²´ê°€ ë˜ë‹ˆê¹Œ ê·¸ê±¸ ìƒê°)' ì¶”ê°€ | ğŸ”µìµœì‹ 
                // 3ë‹¨ê³„ì—ì„œ set ë©”ì†Œë“œì˜ ê¸°ëŠ¥ì„ ì •ì˜í•œë‹¤. 
                
                // 'í´ë˜ìŠ¤ëŠ” ê°ì²´ë¥¼ ë§Œë“¤ì–´ ë‚´ëŠ” í…œí”Œë¦¿' ì´ë¼ëŠ” ê´€ì ì—ì„œ, ì´ ì½”ë“œë¡œ ì¸í•´, í•´ë‹¹ ê°ì²´ ì•ˆì—ì„œ ì–´ë–¤ ì¼ì´ ë²Œì–´ì§€ëŠ”ê°€! ë¥¼ í•´ì„í•´ë³´ë©´ 
                    // this = ìƒˆë¡­ê²Œ ë§Œë“¤ì–´ì§ˆ ê°ì²´ ì¸ìŠ¤í„´ìŠ¤
                    // this.strategy = '2ë‹¨ê³„ì—ì„œ ë§Œë“¤ì–´ì§„ strategy ë¼ëŠ” ë¹ˆ ê°ì²´'
                    // this.strategy[key] = í•´ë‹¹ ë¹ˆ ê°ì²´ì—ì„œ 'ì†ì„±'ì„ ë™ì ìœ¼ë¡œ í• ë‹¹ 
                    // "this.strategy[key] = authenticate" = í•´ë‹¹ ì†ì„±ì— authenticate ë©”ì†Œë“œë¥¼ í• ë‹¹

                // ë§Œì•½ set ë©”ì†Œë“œê°€ ì–´ë– í•œ ë§¥ë½ì—ì„œ ì‹¤í–‰ëœë‹¤ë©´, ë‹¤ìŒì˜ ì¼ì´ ë²Œì–´ì§„ë‹¤. 
                    // 1) string ìœ¼ë¡œ ëœ key ê°€ ìƒê¸´ë‹¤. 
                    // 2) í•´ë‹¹ key ì— Authenticator íƒ€ì…ì´  authenticate ë³€ìˆ˜ì— ë‹´ê¸´ë‹¤. 
                    // ì¦‰, set ì´ ì–´ë– í•œ ë§¥ë½ì—ì„œ ì‹¤í–‰ëœë‹¤ë©´, ë‹¤ìŒì˜ ê°ì²´ê°€ ë§Œë“¤ì–´ì§€ëŠ” ê²ƒ ì´ë‹¤.             
                        // [ì˜ˆì‹œ] set ë©”ì†Œë“œë¥¼ someObject.set('login', loginAuthenticator); ì´ë ‡ê²Œ í˜¸ì¶œí•˜ë©´, ì•„ë˜ì™€ ê°™ì€ ê°ì²´ê°€ ëœë‹¤ â­â­â­â­â­
                            /* 
                                this.strategy = {
                                    google(key ì—ì„œ í• ë‹¹ë°›ì€ ê°’): loginAuthenticator
                                };
                            */ 
                            /* ë˜ëŠ” ì´ë ‡ê²Œ ë‚˜ì˜¨ë‹¤ â­â­â­â­â­â­â­ 
                                this.strategy = {
                                    google(key ì—ì„œ í• ë‹¹ë°›ì€ ê°’): authenticate(credentials)
                                };
                            */
                // ê²°êµ­, ì´ ì½”ë“œë¥¼ ê±°ì¹˜ë©´, instance ëŠ” ì´ë ‡ê²Œ ë¨ â­â­â­ 
                    /*
                        1) instance ì •ì˜
                            instance = {
                                strategy : {}
                                set : function(key, authenticate){      // ê°ì²´ì—ì„œ í•¨ìˆ˜ ë¶€ë¶„ ì •ì˜ê°€ ì´ë ‡ê²Œ ë˜ëŠ” ë¶€ë¶„ì„ ì•½í–ˆìŒ. ğŸ˜¥ğŸ˜¥ğŸ˜¥ 
                                    this.strategy[key] = authenticate;
                                }
                            }
                        2) set ë©”ì†Œë“œ ì‹¤í–‰ë˜ë©´ ë²Œì–´ì§€ëŠ” ì¼
                            instance = {
                                strategy : {
                                    google : authenticate
                                }
                                set : function(key, authenticate){
                                    this.strategy[key] = authenticate;
                                }
                            }
                    */
                
                // ë‹¤ë§Œ, ì´ë ‡ê²Œ ì •ì˜ëœ set ë©”ì†Œë“œê°€ ì•„ì§ ì‹¤í–‰ëœ ê±´ ì•„ë‹˜! 
                // ì´ì œ 4ë‹¨ê³„ì—ì„œ set ë©”ì†Œë“œë¥¼ ì‹¤í–‰í•˜ì 


// [4ë‹¨ê³„] set ë©”ì†Œë“œê°€ index.ts ì—ì„œ ì‹¤í–‰ë¨!  
	// ê·¸ë¡œ ì¸í•´, íŠ¹ì • íƒ€ì…ê³¼ authenticate  ê°ì²´ê°€ ë§Œë“¤ì–´ì ¸ ìˆëŠ” ìƒíƒœ 
		/* this.strategy = {
				google(key ì—ì„œ í• ë‹¹ë°›ì€ ê°’): authenticate(credentials)
			};
		*/


// [5ë‹¨ê³„] setë©”ì†Œë“œê°€ ì‹¤í–‰ë˜ì—ˆë‹¤ëŠ” ê°€ì •í•˜ì—, ê²°ê³¼ë¥¼ result ì— ë„£ê¸°
    public async login (type : string, credentials : UserParams) : Promise<AuthenticationResponse>{
        // google, {email , password} google ì— ëŒ€í•œ í‚¤ ê°’ì„ ì‹¤í–‰ì‹œí‚¤ë©´ì„œ, ì„ì‹œ ê°ì²´ ê°’ì„ ì „ë‹¬
        const result = await this.strategy[type].authenticate(credentials); 
            // ì—¬ê¸°ì— ì„±ê³µ ì‹¤íŒ¨ê°€ ë‹´ê¸¸ ê²ƒ 
            // type ì´ êµ¬ê¸€ì´ë©´, êµ¬ê¸€ ë¡œê·¸ì¸ ë¡œì§ í•¨ìˆ˜ê°€ ì‹¤í–‰ë  ê²ƒ. 
        return result
    }
        // [ver2.2 í•´ì„] | í´ë˜ìŠ¤ë¥¼ 'ê°ì²´ ê´€ì ' ì—ì„œ í•´ì„í•˜ê¸° ì¶”ê°€ | ğŸ”µìµœì‹ 
            // login ë©”ì†Œë“œì˜ ì „ì œëŠ” set ë©”ì†Œë“œê°€ ì´ë¯¸ ì‹¤í–‰ë˜ì–´ì„œ, type ì™€ authenticate ê°€ í• ë‹¹ë˜ì–´ ìˆë‹¤! ë¼ëŠ” ì  ì´ë‹¤. 
            // ì´ì œ login ë©”ì†Œë“œì—ì„œëŠ” ë­˜ í•˜ë‚˜?  
                // 1) ì—¬ëŸ¬ê°œì˜ strategy ì¤‘ 'ì„ íƒ' í•œë‹¤. 
                // 2) ê·¸ë ‡ê²Œ ì„ íƒí•œ ì†ì„±ì˜ ë©”ì†Œë“œë¥¼ ì‹¤í–‰ í•œë‹¤. 
            // êµ¬ì²´ì ìœ¼ë¡œ ì½”ë“œë¡œ ë³´ë©´ 
                // this.strategy[type] = ì´ ë¶€ë¶„ì€ ë‹¤ì–‘í•œ key ì¤‘ í•˜ë‚˜ì˜ type ì„ ì„ íƒ 
                // authenticate(credentials) = ì´ ë¶€ë¶„ì€ í•´ë‹¹ type ì— ì´ë¯¸! í• ë‹¹ë˜ì–´ ìˆëŠ” authenticate ë¥¼ ì‹¤í–‰
                // const result =  authenticator íƒ€ì…ì— ì˜í•´, AuthenticationResponse íƒ€ì…ì„ ë°˜í™˜í•œë‹¤.

            // ì´ ì½”ë“œë¥¼ ê±°ì¹˜ë©´, ê°ì²´ instance ëŠ” ì´ë ‡ê²Œ ë¨
                /* 
                1) instance ì •ì˜
                instance = {
                    strategy : {}, 
                    set : (key, authenticate) => this.strategy[key] = authenticate;
                    login : (type, credentials) => {
                        const result = await this.strategy[type].authenticate(credentials);
                        return result
                    } 
                }

                2) login ë©”ì†Œë“œ ì‹¤í–‰ë˜ê³  ë‚˜ë©´, â­â­instance ê°ì²´ ì •ì˜ë¥¼ ê±´ë“œëŠ”ê²Œ ì•„ë‹˜â­â­ credentials ë§¤ê°œë³€ìˆ˜ë¥¼ íˆ¬ì…í•´ì„œ, 'ì‹¤í–‰' í•œë‹¤.
                    instance = {
                        strategy : {
                            google : authenticate(â­credentialsâ­)  
                                // ì´ë ‡ê²Œ ì½”ë“œê°€ ë³€í™”í•˜ëŠ”ê²Œ ì•„ë‹˜. 
                                // ë‹¨ì§€, ì´ì „ ì½”ë“œì™€ ë‹¤ë¥¸ ê±´, â­credentialsì´ ë§¤ê°œë³€ìˆ˜ë¡œ ë“¤ì–´ê°„ë‹¤ëŠ” ê²ƒâ­ 
                                // [ì‹œì‚¬ì ] ë©”ì†Œë“œê°€ 'ì‹¤í–‰' ëœë‹¤ëŠ” ê±´, ë©”ì†Œë“œ ì•ˆì— ë§¤ê°œë³€ìˆ˜ê°€ ë“¤ì–´ê°„ë‹¤. ëŠ” ê²ƒì„ ì˜ë¯¸í•  ìˆ˜ë„ ìˆë‹¤ëŠ” ê²ƒ. â­â­
                        }
                        set : {ë‚˜ë¦„ì˜ í•¨ìˆ˜ ì •ì˜}
                        login : {ë‚˜ë¦„ì˜ í•¨ìˆ˜ ì •ì˜}
                    }
                */
}


export default Strategy